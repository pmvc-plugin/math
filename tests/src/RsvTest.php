<?php

namespace PMVC\PlugIn\math;

use PMVC\TestCase;

class RsvTest extends TestCase
{
    private $_plug = 'math';

    public function testRsv()
    {
        $data = [
            [
                'c' => 132.3,
                'h' => 132.3,
                'l' => 128,
                'o' => 128.35,
                't' => 20210518,
                'v' => 16255,
            ],
            [
                'c' => 131.4,
                'h' => 132.65,
                'l' => 130.5,
                'o' => 132.2,
                't' => 20210519,
                'v' => 16908,
            ],
            [
                'c' => 130.5,
                'h' => 131.4,
                'l' => 129.7,
                'o' => 131.35,
                't' => 20210520,
                'v' => 9500,
            ],
            [
                'c' => 132.35,
                'h' => 133.85,
                'l' => 131.3,
                'o' => 132.5,
                't' => 20210521,
                'v' => 10077,
            ],
            [
                'c' => 132.15,
                'h' => 132.65,
                'l' => 131.15,
                'o' => 131.55,
                't' => 20210524,
                'v' => 10215,
            ],
            [
                'c' => 134.4,
                'h' => 134.65,
                'l' => 132.9,
                'o' => 132.9,
                't' => 20210525,
                'v' => 9073,
            ],
            [
                'c' => 134.5,
                'h' => 135.15,
                'l' => 133.95,
                'o' => 134.85,
                't' => 20210526,
                'v' => 5124,
            ],
            [
                'c' => 133.55,
                'h' => 133.7,
                'l' => 132.35,
                'o' => 133.5,
                't' => 20210527,
                'v' => 5650,
            ],
            [
                'c' => 135.8,
                'h' => 135.9,
                'l' => 134.3,
                'o' => 134.9,
                't' => 20210528,
                'v' => 9524,
            ],
        ];
        $plug = \PMVC\plug($this->_plug);
        $oRsv = $plug->rsv(3);
        $rsv = $plug->collector(
          $data,
          [$oRsv]
        );
        $kd = $oRsv->calKD(null, null, ['k'=>64.87, 'd'=>60.65]);
        $expected = [
            '20210520' => [
                'rsi' => 53.76,
                'k'   => 64.87,
                'd'   => 60.65,
                'j'   => 52.21,
            ],
            '20210521' => [
                'rsi' => 63.86,
                'k'   => 64.53,
                'd'   => 61.94,
                'j'   => 56.77,
            ],
            '20210524' => [
                'rsi' => 59.04,
                'k'   => 62.7,
                'd'   => 62.2,
                'j'   => 61.19,
            ],
            '20210525' => [
                'rsi' => 92.86,
                'k'   => 72.75,
                'd'   => 65.72,
                'j'   => 51.64,
            ],
            '20210526' => [
                'rsi' => 83.75,
                'k'   => 76.42,
                'd'   => 69.28,
                'j'   => 55.01,
            ],
            '20210527' => [
                'rsi' => 42.86,
                'k'   => 65.23,
                'd'   => 67.93,
                'j'   => 73.34,
            ],
            '20210528' => [
                'rsi' => 97.18,
                'k'   => 75.88,
                'd'   => 70.58,
                'j'   => 59.99,
            ],
        ];
        $this->assertEquals($expected, $kd);
    }
}
